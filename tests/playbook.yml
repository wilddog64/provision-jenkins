---
- hosts: all
  become: yes
  gather_facts: no
  vars_files:
    - ../vars/vaults/jenkins.yml

  vars:
    oracle_java_version: 8
    sshkey_passphrase: "{{ vault_sshkey_passphrase }}"
    jenkins_admin_password: "{{ vault_jenkins_admin_password }}"
    jenkins_git_commiter_name: ec2-deployer
    jenkins_git_commiter_email: operations@dreambox.com
    jenkins_github_api_token: "{{ vault_jenkins_github_api_token }}"
    jenkins_github_org: dreamboxlearning
    jenkins_github_repo: dreamboxlearning/{{ ansible_hostname }}-jenkins-scm
    jenkins_sync_repo_empty: 1
    jenkins_allow_manage_hosts_file: yes
    jenkins_server_password: "{{ vault_jenkins_server_password }}"
    jenkins_server_key_path: /tmp/server.passwd.key
    jenkins_server_private_key_path: /tmp/server.key
    jenkins_selfsigned_cert_expired_days: 365
    jenkins_enable_selfsigned_ssl: yes
    jenkins_create_private_github_repo: no
    jenkins_enable_github_repo: no

  roles:
    - { role: manage-hosts-file, when: "jenkins_allow_manage_hosts_file" }
    - provision-oracle-java
    - provision-jenkins
